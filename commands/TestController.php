<?php

namespace app\commands;

use app\clients\bybit\Client;
use app\telegram\crypto_signal\determine\SignalDetermine;
use Yii;
use yii\console\Controller;

class TestController extends Controller
{
    public function actionMarket()
    {
        $client = new Client();
        $client->token = Yii::$app->params['market']['bybit']['token'];
        $client->secret = Yii::$app->params['market']['bybit']['secret'];

//        $response = $client->getOrderbook('spot');
//        $response = $client->walletBalance('UNIFIED');
        $response = $client->instrumentsInfo('spot', 'PEPEUSDT');
        print_r($response);
    }

    public function actionIndex()
    {
        $message = <<<HTML
Ð¡Ð¾Ð²ÐµÑ€ÑˆÐ¸Ð» ÑÐ´ÐµÐ»ÐºÑƒ Ð¿Ð¾ Ð¿Ð¾ÐºÑƒÐ¿ÐºÐµ Ð´Ð»Ð¸Ð½Ð½Ð¾Ð¹ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¸ (LONG) Ð¿Ð¾ Ð¿Ð°Ñ€Ðµ       COMP/USDT  
        
Ð¢ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹:        
        
ðŸŸ¢  ÐŸÐ¾ÐºÑƒÐ¿ÐºÐ°   COMP/USDT      30.01.2025
        
ðŸ’° Ð”Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½ Ð²Ñ…Ð¾Ð´Ð°     $69,00000  -  $70,00000
        
ðŸŽ¯ Ð¦ÐµÐ»ÑŒ 1 -     $72,00000    
        
ðŸŽ¯ Ð¦ÐµÐ»ÑŒ 2 -     $75,00000    
        
        
â›”ï¸ Ð¡Ñ‚Ð¾Ð¿ Ð·Ð° ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ   -  $68,60000    
        
Ð‘ÐµÑ€ÐµÐ¼ Ð² Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶ÐµÐ½Ð¸Ðµ Ñ€Ð¾ÑÑ‚Ð°        
        
        
Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ñ: ÐŸÐ¾ÑÐ»Ðµ Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ñ Ñ†ÐµÐ½Ñ‹ Ð¿Ð¾Ñ€ÑÐ´ÐºÐ° 2-3 % Ð² Ð½Ð°ÑˆÑƒ ÑÑ‚Ð¾Ñ€Ð¾Ð½Ñƒ Ð¾Ñ‚ Ñ‚Ð¾Ñ‡ÐºÐ¸ Ð²Ñ…Ð¾Ð´Ð°, Ð½Ðµ Ð´Ð¾Ð¶Ð¸Ð´Ð°Ñ‚ÑŒÑÑ Ñ‚ÐµÐ¹ÐºÐ¾Ð², ÑÑ€Ð°Ð·Ñƒ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ð¸Ñ‚ÑŒ ÑÑ‚Ð¾Ð¿ Ð² Ð‘Ð£, Ñ‚Ð°Ðº Ð¶Ðµ Ð¼Ð¾Ð¶Ð½Ð¾ ÐµÐ³Ð¾ Ð¿Ð¾Ð´Ð¾Ð´Ð²Ð¸Ð³Ð°Ñ‚ÑŒ Ð² ÑÐ»ÐµÐ´ Ð·Ð° Ñ†ÐµÐ½Ð¾Ð¹ Ð´ÐµÑ€Ð¶Ð° ÐµÐ³Ð¾ Ð² Ñ€Ð°Ð¹Ð¾Ð½Ðµ 2-3% Ð¾Ñ‚ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ¹ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚Ð¸.        
        
ðŸ‘ðŸ¼- Ð²Ñ…Ð¾Ð¶Ñƒ Ð² ÑÐ´ÐµÐ»ÐºÑƒ        
ðŸ‘€- Ð½Ðµ ÑƒÑÐ¿ÐµÐ» Ð²Ð¾Ð¹Ñ‚Ð¸        
ðŸ¤·- Ð¿Ñ€Ð¾Ð¿ÑƒÑÐºÐ°ÑŽ        
ðŸ§‘â€ðŸ’»- Ð·Ð°Ð¹Ð´Ñƒ Ð² ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÑƒÑŽ        
Ð’ÑÐµ Ñ€ÐµÐ°ÐºÑ†Ð¸Ð¸ Ð² ÐºÐ°Ð½Ð°Ð»Ðµ Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ñ‹ Ð¸Ð¼ÐµÐ½Ð½Ð¾ Ð¿Ð¾ ÑÑ‚Ð¾Ð¼Ñƒ Ð¿Ñ€Ð¸Ð½Ñ†Ð¸Ð¿Ñƒ.        
Ð’ÑÐµÐ¼ ÑƒÐ´Ð°Ñ‡Ð¸ Ð¸ Ð±Ð¾Ð»ÑŒÑˆÐ¾Ð³Ð¾ Ð¿Ñ€Ð¾Ñ„Ð¸Ñ‚Ð°. ðŸ¥°
HTML;

        $message2 = <<<HTML
#ÑÐ»ÑƒÑ…Ð¸ 
ÐÐ°Ñˆ Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸Ðº ÑÐ¾Ð¾Ð±Ñ‰Ð°ÐµÑ‚, Ñ‡Ñ‚Ð¾ Ð¿Ð¾ÑÐ»Ðµ Ñ‚Ð¾Ð³Ð¾, ÐºÐ°Ðº Ñ€Ð¾ÑÑÐ¸ÑÐ½Ðµ Ð²Ð·Ð»Ð¾Ð¼Ð°Ð»Ð¸ Ð”Ð˜Ð®, Ð¾Ð½Ð¸ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ð»Ð¸ Ñ‡Ð°ÑÑ‚Ð¸Ñ‡Ð½Ñ‹Ð¹ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº Ð´Ð°Ð½Ð½Ñ‹Ð¼ Ð¿Ð¾ Ð·Ð° Ð±Ñ€Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¼ Ð¾Ñ‚ Ð¼Ð¾Ð±Ð¸Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸ ÑƒÐºÑ€Ð°Ð¸Ð½Ñ†Ð°Ð¼, Ð³Ð´Ðµ Ð±Ñ‹Ð»Ð° ÑƒÐºÐ°Ð·Ð°Ð½Ð° Ð²ÑÑ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ, Ð³Ð´Ðµ Ð¸ ÐºÐµÐ¼ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‚.
Ð¢Ð°Ðº Ð²Ð¾Ñ‚ ÑÑ‚Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¿Ð¾Ð¼Ð¾Ð³Ð»Ð¸ Ñ€Ð¾ÑÑÐ¸ÑÐ½Ð°Ð¼ Ð²Ñ‹ÑÐ²Ð¸Ñ‚ÑŒ Ð´ÐµÑ†ÐµÐ½Ñ‚Ñ€Ð°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð¿Ñ€ÐµÐ´Ð¿Ñ€Ð¸ÑÑ‚Ð¸Ñ Ð¿Ð¾ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´ÑÑ‚Ð²Ñƒ Ð¸ ÑÐ±Ð¾Ñ€Ñƒ fpv Ð´Ñ€Ð¾Ð½Ð¾Ð². ÐŸÐ¾ÑÐ»Ðµ ÑÑ‚Ð¾Ð³Ð¾ Ñ‚ÑƒÐ´Ð° Ð¿Ñ€Ð¸Ð»ÐµÑ‚ÐµÐ»Ð¸ Ð‘ÐŸÐ›Ð Ð“ÐµÑ€Ð°Ð½ÑŒ (Â«ÑˆÐ°Ñ…ÐµÐ´Ñ‹Â»). Ð£ÐºÑ€Ð°Ð¸Ð½ÑÐºÐ¸Ðµ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»Ð¸ Ð¿Ð¾Ð½ÐµÑÐ»Ð¸ ÑƒÑ‰ÐµÑ€Ð± Ð½Ð° Ð¼Ð¸Ð»Ð»Ð¸Ð¾Ð½Ñ‹ Ð´Ð¾Ð»Ð»Ð°Ñ€Ð¾Ð² Ð¸ Ð¿Ð¾Ñ‚ÐµÑ€ÑÐ»Ð¸ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ðµ Ð»Ð¸Ð½Ð¸Ð¸.

Ð”Ð°Ð½Ð½ÑƒÑŽ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð²ÑÑÑ‡ÐµÑÐºÐ¸ Ð·Ð°Ð¼Ð°Ð»Ñ‡Ð¸Ð²Ð°ÑŽÑ‚.
HTML;


        $determine = new SignalDetermine();


//       $result =  $determine->check($message);
//var_dump($result);
        $result = $determine->process($message);
        print_r($result);
//        file_put_contents(Yii::getAlias('@app/runtime/cache/result.json'), $result);
    }
}